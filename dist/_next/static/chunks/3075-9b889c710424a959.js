"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3075],{3075:function(e,a,s){var l=s(2122),t=s(8483),c=s(7740),n=s(7662),r=s(4418),o=s(2165),i=s(2761),d=s(2893),m=s(2315),x=s(8690),h=s(3495),j=s(8661),E=s(4527),N=s(15),p=s(3851),u=s(954);a.Z=e=>{let{pageType:a,onSubmit:s}=e,A=(0,t.useRef)(null),g=(0,x.useRouter)(),[_,f]=t.useState(!1),[T,M]=t.useState([]),[I,b]=(0,t.useState)(),[v,C]=(0,t.useState)({}),[S,y]=(0,t.useState)(""),[U,P]=(0,t.useState)(!1),[F,O]=(0,t.useState)(""),D=localStorage.getItem("sid"),R=localStorage.getItem("processInstId"),w=localStorage.getItem("taskInstId"),[B,k]=(0,t.useState)(!1),K="http://localhost:8088/portal/r/w?&sid=".concat(D,"&cmd=CLIENT_BPM_FORM_TRACK_OPEN&processInstId=").concat(R,"&formInfo="),L=(0,N.Z)(),Q=()=>{A.current.show({severity:"success",summary:"提交成功",detail:H("DOCUMENT_NUM")})},W=()=>{A.current.show({severity:"success",summary:"更新成功",detail:H("DOCUMENT_NUM")})},{control:J,formState:{errors:Z},handleSubmit:z,getValues:H,reset:V}=(0,c.cI)({defaultValues:{DOCUMENT_NUM:"",WBS_ELEMENT:"",MATERIAL_NUM:"",BOOK_NAME:"",OBJECT_NUM:"",DEPT_NUM:"",DEPT_NAME:"",OBJECT_NAME:"",CHIEF:"",PLANER_NAME:"",COMPANY_CODE:"",PLANER_NUM:"",CREATEUSER:"",CREATEDATE:"",UPDATEUSER:"",UPDATEDATE:"",TYPE:"WBS 元素"}}),q=async e=>{let a=Object.entries(e).filter(e=>{let[a,s]=e;return""!==s}).map(e=>{let[a,s]=e;return"".concat(encodeURIComponent(a),"=").concat(encodeURIComponent(s))}).join("&"),s=localStorage.getItem("sid"),l=localStorage.getItem("uid"),t="".concat(m.Z,"?&uid=").concat(l,"&cmd=").concat("com.awspaas.user.apps.app20231017165850.createForm","&sid=").concat(s,"&").concat(a),c=await fetch(t,{method:"POST"}),n=await c.json();console.log(n),"ok"===n.result&&(Q(),localStorage.setItem("boid",n.data),setTimeout(()=>{g.push("/pages/invoice/".concat(n.data))},1e3),Y())},Y=async()=>{let e=localStorage.getItem("sid"),a=localStorage.getItem("boid"),s=await fetch("".concat(m.Z,"?cmd=").concat("com.awspaas.user.apps.app20231017165850.queryFormDetail","&sid=").concat(e,"&boid=").concat(a)),l=await s.json();console.log(l),C(l)},G=async e=>{let a=Object.entries(e).filter(e=>{let[a,s]=e;return""!==s}).map(e=>{let[a,s]=e;return"".concat(encodeURIComponent(a),"=").concat(encodeURIComponent(s))}).join("&"),s=localStorage.getItem("sid"),l=localStorage.getItem("uid"),t=localStorage.getItem("boid"),c="".concat(m.Z,"?").concat(l,"&cmd=").concat("com.awspaas.user.apps.app20231017165850.updateForm","&sid=").concat(s,"&").concat(a,"&ID=").concat(t),n=await fetch(c,{method:"POST"}),r=await n.json();console.log(r),"ok"===r.result&&W()},X=async()=>{let e=localStorage.getItem("sid"),a="".concat(m.Z,"?cmd=").concat("com.awspaas.user.apps.app20231017165850.queryWBSList","&sid=").concat(e),s=await fetch(a,{method:"POST"}),l=await s.json();console.log(l),M(l)},$=e=>{Object.keys(e).forEach(a=>{void 0===e[a]&&delete e[a]}),console.log(e);let s={...e,TYPE:"WBS element"};"new"===a?q(s):"edit"===a&&G(s)},ee=async(e,a)=>{let s=localStorage.getItem("sid"),l=localStorage.getItem("uid"),t=localStorage.getItem("processInstId"),c=localStorage.getItem("taskInstId"),n="".concat(m.Z,"?cmd=").concat("CLIENT_BPM_FORM_PAGE_P_SAVE_DATA","&sid=").concat(s,"&processInstId=").concat(t,"&taskInstId=").concat(c,"&openState=").concat(1,"&currentPage=").concat(1,"&formDefId=").concat("","&formData=").concat("","&boId=").concat("","&boDefId=").concat("","&oldFormData=").concat("","&idCreate=").concat(!0,"&isTransact=").concat(!0,"&isValidateForm=").concat("提交"===a||"false","&commentInfo=").concat(JSON.stringify("办理"===a?{msg:e,isSelected:!0,commentId:"".concat(L),isCommentCreate:!0,hasFiles:!1,setComments:!1,processDefId:"obj_e9a85bafeeba49e2aa079b00ae93eefa"}:{msg:e,isSelected:!0,isValidateForm:"提交"===a||"false",commentOption:a,commentId:"".concat(L),isCommentCreate:!0,hasFiles:!1,setComments:!1,processDefId:"obj_e9a85bafeeba49e2aa079b00ae93eefa"}),"&isNew=").concat("");if("提交"===a||"拒绝"===a){let e=await fetch(n,{method:"POST"}),a=await e.json();console.log(a),await fetch("".concat(m.Z,"?sid=").concat(s,"&cmd=CLIENT_BPM_TASK_TRANSACT&processInstId=").concat(t,"&taskInstId=").concat(c,"&openState=1&currentPage=1&selectRole=&isBatch=&isVue=true"),{method:"POST"})}"办理"===a&&await fetch("".concat(m.Z,"?sid=").concat(s,"&cmd=com.awspaas.user.apps.app20231017165850.completeTask&uid=").concat(l,"&taskInstId=").concat(c),{method:"POST"}),"作废"===a&&await fetch("".concat(m.Z,"?sid=").concat(s,"&cmd=CLIENT_BPM_TASK_DEL_TASK&uid=").concat(l,"&taskInstId=").concat(c,"&processInstId=").concat(t))},ea=e=>Z[e]?(0,l.jsx)("small",{className:"p-error",children:Z[e].message}):(0,l.jsx)("small",{className:"p-error",children:"\xa0"}),es=async()=>{let e=await fetch("".concat(m.Z,"?sid=").concat(D,"&cmd=CLIENT_BPM_FORM_MAIN_PAGE_JSON&processInstId=").concat(R,"&taskInstId=").concat(w,"&currentPage=1&openState=1&formDefId=&boId=&displayToolbar=true&lang=")),a=await e.json();console.log(a),a.data.usertaskComment&&a.data.usertaskComment.actionOpinions&&k(!0)};(0,t.useEffect)(()=>{if(es(),X(),"edit"===a||"approve"===a){let e=localStorage.getItem("boid"),a=localStorage.getItem("sid"),s="".concat(m.Z,"?cmd=").concat("com.awspaas.user.apps.app20231017165850.queryFormDetail","&sid=").concat(a,"&boid=").concat(e);fetch(s,{method:"POST"}).then(e=>e.json()).then(e=>{console.log(e),V({DOCUMENT_NUM:e.DOCUMENT_NUM,OBJECT_NUM:e.OBJECT_NUM,OBJECT_NAME:e.OBJECT_NAME,MATERIAL_NUM:e.MATERIAL_NUM,BOOK_NAME:e.BOOK_NAME,CHIEF:e.CHIEF,PLANER_NUM:e.PLANER_NUM,PLANER_NAME:e.PLANER_NAME,DEPT_NUM:e.DEPT_NUM,DEPT_NAME:e.DEPT_NAME,CREATEDATE:e.CREATEDATE,CREATEUSER:e.CREATEUSER,UPDATEDATE:e.UPDATEDATE,UPDATEUSER:e.UPDATEUSER})})}},[]);let el="approve"===a,et=async()=>{let e=localStorage.getItem("sid"),a=localStorage.getItem("uid"),s=localStorage.getItem("boid"),l="".concat(m.Z,"?uid=").concat(a,"&cmd=").concat("com.awspaas.user.apps.app20231017165850.startProcess","&sid=").concat(e,"&boid=").concat(s,"&processDefId=").concat("obj_e9a85bafeeba49e2aa079b00ae93eefa"),t=await fetch(l,{method:"POST"}),c=await t.json();console.log(c),"ok"===c.result&&(Q(),V())};return(0,l.jsxs)("form",{onSubmit:z($),className:"flex flex-column gap-2",children:[(0,l.jsx)(i.F,{ref:A}),(0,l.jsx)(o.s,{header:"项目信息",children:(0,l.jsxs)("div",{className:"p-fluid formgrid grid",children:[(0,l.jsx)("div",{className:"field col-12 md:col-span",children:(0,l.jsx)(c.Qr,{name:"DOCUMENT_NUM",control:J,rules:{required:"凭证编号 is required."},disabled:el,render:e=>{let{field:a,fieldState:s}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("label",{htmlFor:a.name,children:"凭证编号"}),(0,l.jsx)(r.o,{id:a.name,type:"text",...a,className:(0,d.AK)({"p-invalid":s.error})}),ea(a.name)]})}})}),(0,l.jsx)("div",{className:"field col-12 md:col-3",children:(0,l.jsx)(c.Qr,{name:"OBJECT_NUM",control:J,disabled:el,render:e=>{let{field:a,fieldState:s}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("label",{htmlFor:a.name,children:"WBS 元素"}),(0,l.jsx)(r.o,{id:a.name,type:"text",...a,className:(0,d.AK)({"p-invalid":s.error})}),ea(a.name)]})}})}),(0,l.jsx)("div",{className:"field col-12 md:col-8",children:(0,l.jsx)(c.Qr,{name:"OBJECT_NAME",control:J,disabled:el,render:e=>{let{field:a,fieldState:s}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("label",{htmlFor:a.name,children:"\xa0"}),(0,l.jsx)(r.o,{id:a.name,type:"text",...a,className:(0,d.AK)({"p-invalid":s.error})}),ea(a.name)]})}})}),(0,l.jsx)("div",{className:"field col-12 md:col-1",children:(0,l.jsxs)("div",{className:"flex items-center my-4",children:[(0,l.jsx)("label",{children:"\xa0"}),(0,l.jsx)(n.z,{disabled:el,icon:"pi pi-search",rounded:!0,text:!0,raised:!0,severity:"success","aria-label":"Search",onClick:()=>{f(!0)}})]})}),(0,l.jsx)("div",{className:"field col-12 md:col-3",children:(0,l.jsx)(c.Qr,{name:"MATERIAL_NUM",control:J,disabled:el,render:e=>{let{field:a,fieldState:s}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("label",{htmlFor:a.name,children:"物料号"}),(0,l.jsx)(r.o,{id:a.name,type:"text",...a,className:(0,d.AK)({"p-invalid":s.error})}),ea(a.name)]})}})}),(0,l.jsx)("div",{className:"field col-12 md:col-3",children:(0,l.jsx)(c.Qr,{name:"DEPT_NUM",control:J,disabled:el,render:e=>{let{field:a,fieldState:s}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("label",{htmlFor:a.name,children:"所属部门"}),(0,l.jsx)(r.o,{id:a.name,type:"text",...a,className:(0,d.AK)({"p-invalid":s.error})}),ea(a.name)]})}})}),(0,l.jsx)("div",{className:"field col-12 md:col-6",children:(0,l.jsx)(c.Qr,{name:"DEPT_NAME",control:J,disabled:el,render:e=>{let{field:a,fieldState:s}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("label",{htmlFor:a.name,children:"\xa0"}),(0,l.jsx)(r.o,{id:a.name,type:"text",...a,className:(0,d.AK)({"p-invalid":s.error})}),ea(a.name)]})}})}),(0,l.jsx)("div",{className:"field col-12 md:col-12",children:(0,l.jsx)(c.Qr,{name:"BOOK_NAME",control:J,disabled:el,render:e=>{let{field:a,fieldState:s}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("label",{htmlFor:a.name,children:"书名"}),(0,l.jsx)(r.o,{id:a.name,type:"text",...a,className:(0,d.AK)({"p-invalid":s.error})}),ea(a.name)]})}})}),(0,l.jsx)("div",{className:"field col-12 md:col-9",children:(0,l.jsx)(c.Qr,{name:"CHIEF",control:J,disabled:el,render:e=>{let{field:a,fieldState:s}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("label",{htmlFor:a.name,children:"著译者"}),(0,l.jsx)(r.o,{id:a.name,type:"text",...a,className:(0,d.AK)({"p-invalid":s.error})}),ea(a.name)]})}})}),(0,l.jsx)("div",{className:"field col-12 md:col-3",children:(0,l.jsx)(c.Qr,{name:"PLANER_NAME",control:J,disabled:el,render:e=>{let{field:a,fieldState:s}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("label",{htmlFor:a.name,children:"策划编辑"}),(0,l.jsx)(r.o,{id:a.name,type:"text",...a,className:(0,d.AK)({"p-invalid":s.error})}),ea(a.name)]})}})}),(0,l.jsx)("div",{className:"field col-12 md:col-3",children:(0,l.jsx)(c.Qr,{name:"CREATEUSER",control:J,disabled:el,render:e=>{let{field:a,fieldState:s}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("label",{htmlFor:a.name,children:"创建人"}),(0,l.jsx)(r.o,{id:a.name,type:"text",...a,className:(0,d.AK)({"p-invalid":s.error})}),ea(a.name)]})}})}),(0,l.jsx)("div",{className:"field col-12 md:col-3",children:(0,l.jsx)(c.Qr,{name:"CREATEDATE",control:J,disabled:el,render:e=>{let{field:a,fieldState:s}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("label",{htmlFor:a.name,children:"创建日期"}),(0,l.jsx)(r.o,{id:a.name,type:"text",...a,className:(0,d.AK)({"p-invalid":s.error})}),ea(a.name)]})}})}),(0,l.jsx)("div",{className:"field col-12 md:col-3",children:(0,l.jsx)(c.Qr,{name:"UPDATEUSER",control:J,disabled:el,render:e=>{let{field:a,fieldState:s}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("label",{htmlFor:a.name,children:"最后修改人"}),(0,l.jsx)(r.o,{id:a.name,type:"text",...a,className:(0,d.AK)({"p-invalid":s.error})}),ea(a.name)]})}})}),(0,l.jsx)("div",{className:"field col-12 md:col-3",children:(0,l.jsx)(c.Qr,{name:"UPDATEDATE",control:J,disabled:el,render:e=>{let{field:a,fieldState:s}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("label",{htmlFor:a.name,children:"最后修改日期"}),(0,l.jsx)(r.o,{id:a.name,type:"text",...a,className:(0,d.AK)({"p-invalid":s.error})}),ea(a.name)]})}})})]})}),(0,l.jsx)(o.s,{header:"费用计入",children:(0,l.jsxs)("div",{className:"p-fluid formgrid grid",children:[(0,l.jsx)("div",{className:"field col-12 md:col-3",children:(0,l.jsx)(c.Qr,{name:"OBJECT_NUM",control:J,disabled:el,render:e=>{let{field:a,fieldState:s}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("label",{htmlFor:a.name,children:"WBS 元素"}),(0,l.jsx)(r.o,{id:a.name,type:"text",...a,className:(0,d.AK)({"p-invalid":s.error})}),ea(a.name)]})}})}),(0,l.jsx)("div",{className:"field col-12 md:col-8",children:(0,l.jsx)(c.Qr,{name:"OBJECT_NAME",control:J,disabled:el,render:e=>{let{field:a,fieldState:s}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("label",{htmlFor:a.name,children:"\xa0"}),(0,l.jsx)(r.o,{id:a.name,type:"text",...a,className:(0,d.AK)({"p-invalid":s.error})}),ea(a.name)]})}})}),(0,l.jsx)("div",{className:"field col-12 md:col-1",children:(0,l.jsxs)("div",{className:"flex items-center my-4",children:[(0,l.jsx)("label",{children:"\xa0"}),(0,l.jsx)(n.z,{icon:"pi pi-search",rounded:!0,text:!0,raised:!0,severity:"success","aria-label":"Search"})]})}),(0,l.jsx)("div",{className:"field col-12 md:col-4",children:(0,l.jsx)(c.Qr,{name:"COMPANY_CODE",control:J,disabled:el,render:e=>{let{field:a,fieldState:s}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("label",{htmlFor:a.name,children:"公司代码"}),(0,l.jsx)(r.o,{id:a.name,type:"text",...a,className:(0,d.AK)({"p-invalid":s.error})}),ea(a.name)]})}})}),(0,l.jsx)("div",{className:"field col-12 md:col-4",children:(0,l.jsx)(c.Qr,{name:"PLANER_NUM",control:J,disabled:el,render:e=>{let{field:a,fieldState:s}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("label",{htmlFor:a.name,children:"申请人编号"}),(0,l.jsx)(r.o,{id:a.name,type:"text",...a,className:(0,d.AK)({"p-invalid":s.error})}),ea(a.name)]})}})}),(0,l.jsx)("div",{className:"field col-12 md:col-4",children:(0,l.jsx)(c.Qr,{name:"administrator",control:J,disabled:el,render:e=>{let{field:a,fieldState:s}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("label",{htmlFor:a.name,children:"管理员"}),(0,l.jsx)(r.o,{id:a.name,type:"text",...a,className:(0,d.AK)({"p-invalid":s.error})}),ea(a.name)]})}})})]})}),"approve"===a&&(0,l.jsx)(o.s,{header:"审批意见",children:(0,l.jsx)(p.g,{className:"w-full",value:S,onChange:e=>y(e.target.value),rows:5})}),(0,l.jsxs)("div",{className:"field col-12 md-4 flex gap-3 justify-end",children:["approve"===a&&(0,l.jsxs)(l.Fragment,{children:[B?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.z,{onClick:()=>{ee(S,"提交")},label:"同意",outlined:!0,severity:"success",icon:"pi pi-check"}),(0,l.jsx)(n.z,{onClick:()=>{ee(S,"拒绝")},label:"拒绝",outlined:!0,severity:"danger",icon:"pi pi-times"})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.z,{onClick:()=>{ee("","办理")},label:"办理",outlined:!0,severity:"success",icon:"pi pi-check"}),(0,l.jsx)(n.z,{onClick:()=>{ee(S,"作废")},label:"作废",outlined:!0,severity:"danger",icon:"pi pi-times"})]}),(0,l.jsx)(n.z,{label:"跟踪",outlined:!0,severity:"info",icon:"pi pi-times",onClick:()=>{P(!0)}})]}),("edit"===a||"new"===a)&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.z,{label:"保存",onClick:z($),type:"submit",severity:"info",icon:"pi pi-save"}),(0,l.jsx)(n.z,{label:"提交",onClick:et,severity:"success",icon:"pi pi-check"})]})]}),(0,l.jsx)(h.V,{header:"WBS 元素",visible:_,style:{width:"50vw"},onHide:()=>f(!1),children:(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)(j.w,{value:T,paginator:!0,className:"p-datatable-gridlines",showGridlines:!0,rows:5,dataKey:"ID",filterDisplay:"menu",responsiveLayout:"scroll",emptyMessage:"没有数据.",selection:I,onSelectionChange:e=>{b(e.value),console.log(e.value)},children:[(0,l.jsx)(E.s,{selectionMode:"single",exportable:!1}),(0,l.jsx)(E.s,{field:"TOPIC_NUM",header:"选题单凭证编号",style:{width:"10rem",minWidth:"10rem"}}),(0,l.jsx)(E.s,{field:"WBS_ELEMENT",header:"WBS元素",style:{minWidth:"4rem"}}),(0,l.jsx)(E.s,{field:"MATERIAL_NUM",header:"物料号",style:{minWidth:"4rem"}}),(0,l.jsx)(E.s,{field:"BOOK_NAME",header:"书名",style:{minWidth:"4rem"}}),(0,l.jsx)(E.s,{field:"CHIEF",header:"主编(著译者)",style:{minWidth:"4rem"}}),(0,l.jsx)(E.s,{field:"PLANER_NUM",header:"策划编辑",style:{minWidth:"4rem"}}),(0,l.jsx)(E.s,{field:"DEPT_NAME",header:"所属部门",style:{minWidth:"4rem"}})]}),(0,l.jsx)("div",{className:"flex justify-end",children:(0,l.jsx)(n.z,{label:"确认",type:"submit",severity:"success",icon:"pi pi-check",onClick:()=>{f(!1),V({DOCUMENT_NUM:null==I?void 0:I.TOPIC_NUM,OBJECT_NUM:null==I?void 0:I.WBS_ELEMENT,OBJECT_NAME:null==I?void 0:I.BOOK_NAME,MATERIAL_NUM:null==I?void 0:I.MATERIAL_NUM,BOOK_NAME:null==I?void 0:I.BOOK_NAME,CHIEF:null==I?void 0:I.CHIEF,PLANER_NUM:null==I?void 0:I.PLANER_NUM,PLANER_NAME:null==I?void 0:I.PLANER_NAME,DEPT_NUM:null==I?void 0:I.DEPT_NUM,DEPT_NAME:null==I?void 0:I.DEPT_NAME})}})})]})}),(0,l.jsx)(u.Y,{visible:U,position:"right",className:"w-8",onHide:()=>P(!1),children:(0,l.jsx)("iframe",{src:K,className:"w-full h-full"})})]})}},2315:function(e,a){a.Z="http://localhost:8088/portal/r/jd"}}]);